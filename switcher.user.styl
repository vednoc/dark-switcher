/* ==UserStyle==
@name         Dark-Switcher
@namespace    gitlab.com/vednoc/dark-switcher
@description  Settings companion for my userstyles.
@author       vednoc <vednoc@pm.me> (https://gitlab.com/vednoc)
@homepageURL  https://gitlab.com/vednoc/dark-switcher
@supportURL   https://gitlab.com/vednoc/dark-switcher/issues
@updateURL    https://gitlab.com/vednoc/dark-switcher/raw/master/switcher.user.styl
@preprocessor stylus
@version      1.7.0
@license      MIT

@var checkbox overwrite 'Use `!important` to overwrite colors' 1
@var checkbox deepdark  'Overwrite colors for DeepDark themes' 1
@var checkbox whatsapp  'Overwrite Dark-WhatsApp bubbles     ' 1
@var checkbox wa_msg_c  'WhatsApp: Brighter message bubbles  ' 1
@var checkbox wa_intro  'WhatsApp: Custom intro image colors ' 1

@var checkbox ow_acvar  'Explicitly overwrite accent variable' 0
@var color    ow_ac     'Overwrite: Accent variable color    ' #ff3f0f

@var checkbox ow_bbvar  'Explicitly overwrite bb variable    ' 0
@var color    ow_bb     'Overwrite: Custom background        ' #00000015

@var checkbox ow_shvar  'Explicitly overwrite shadow variable' 0
@var color    ow_sh     'Overwrite: Custom shadow color      ' #00000030

@var select primary 'Primary colors' {
    'Gruvbox Dark Medium    *': 'gruvbox-dark-medium     ',
    'Gruvbox Dark Hard       ': 'gruvbox-dark-hard       ',
    'Gruvbox Dark Soft       ': 'gruvbox-dark-soft       ',
    'Gruvbox Light Medium    ': 'gruvbox-light-medium    ',
    'Gruvbox Light Hard      ': 'gruvbox-light-hard      ',
    'Gruvbox Light Soft      ': 'gruvbox-light-soft      ',
    'DeepDark                ': 'deep-dark               ',
    'Solarized Dark          ': 'solarized-dark          ',
    'Solarized Light         ': 'solarized-light         ',
    'BreezeDark              ': 'breeze-dark             ',
    'Pitch Black             ': 'pitch-black             ',
    'Inspired Dark           ': 'inspired-dark           ',
    'Adapta Nokto            ': 'adapta-nokto            ',
    'Dracula                 ': 'dracula                 ',
    'Nord Polar Night        ': 'nord-dark               ',
    'Nord Snow Storm         ': 'nord-light              ',
    'Arc Dark                ': 'arc-dark                ',
    'HavocOS                 ': 'havoc-os                ',
    'Nier                    ': 'nier                    ',
    'GitHub-Dark             ': 'github-dark             ',
    'Github-Moonlight        ': 'moonlight               ',
    'Monokai                 ': 'monokai                 ',
    'Horizon                 ': 'horizon                 ',
    'Doom One                ': 'doom-one                ',
    'Brave Dark              ': 'brave-dark              ',
    'Custom colors           ': 'custom                  ',
}

@var select secondary 'Secondary colors' {
    'Gruvbox Neutral        *': 'gruvbox-neutral         ',
    'Gruvbox Bright          ': 'gruvbox-bright          ',
    'Gruvbox Faded           ': 'gruvbox-faded           ',
    'DeepDark                ': 'deep-dark               ',
    'Solarized               ': 'solarized               ',
    'Dracula                 ': 'dracula                 ',
    'Nord                    ': 'nord                    ',
    'GitHub-Dark             ': 'github-dark             ',
    'GitHub-Moonlight        ': 'moonlight               ',
    'Monokai                 ': 'monokai                 ',
    'Horizon                 ': 'horizon                 ',
    'Doom One                ': 'doom-one                ',
    'Custom colors           ': 'custom                  ',
}

@var color bb      'Custom: Background color  ' #1a1a1a
@var color bg_     'Custom: Primary bg color  ' #212121
@var color hl      'Custom: Highlight bg color' #2b2b2b
@var color bd      'Custom: Secondary bg color' #3e3e3e
@var color fg_     'Custom: Primary fg color  ' #cccccc
@var color cm      'Custom: Secondary fg color' #9d9d9d
@var color ac_     'Custom: Accent color      ' #0f8f7f
@var color sh      'Custom: Shadow color      ' #00000065
@var color red     'Custom: Red color         ' #a54242
@var color orange  'Custom: Orange color      ' #de935f
@var color yellow  'Custom: Yellow color      ' #f0c674
@var color magenta 'Custom: Magenta color     ' #b294bb
@var color violet  'Custom: Violet color      ' #85678f
@var color green   'Custom: Green color       ' #8c9440
@var color blue    'Custom: Blue color        ' #5f819d
@var color cyan    'Custom: Cyan color        ' #5e8d87
==/UserStyle== */

// Whether to use `!important` or not.
if (overwrite) { i = !important }

// Mixin -> Convert HEX to RGB.
to_rgb(input) {
    unquote(slice(s('%s', rgba(input, 0)), 5, -3))
}
// Mixin -> Convert to SVG-friendly colors.
to_svg(input) {
    s('\%23%s', unquote(substr(s('%s', input), 1, 6)))
}

// Primary colors.
Primary = {
    'gruvbox-dark-medium': {
        _bb: #232323
        _bg: #282828
        _hl: #32302f
        _bd: #3c3836
        _fg: #fbf1c7
        _cm: #d5c4a1
        _ac: #d65d0e
        _sh: #00000018
    },
    'gruvbox-dark-hard': {
        _bb: #181b1c
        _bg: #1d2021
        _hl: #282828
        _bd: #3c3836
        _fg: #fbf1c7
        _cm: #d5c4a1
        _ac: #d65d0e
        _sh: #00000018
    },
    'gruvbox-dark-soft': {
        _bb: #2e2c2b
        _bg: #32302f
        _hl: #363433
        _bd: #44403d
        _fg: #fbf1c7
        _cm: #d5c4a1
        _ac: #d65d0e
        _sh: #00000018
    },
    'gruvbox-light-medium': {
        _bb: #faeebb
        _bg: #fbf1c7
        _hl: #ebdbb2
        _bd: #d5c4a1
        _fg: #3c3836
        _cm: #665c54
        _ac: #d65d0e
        _sh: #00000006
    },
    'gruvbox-light-hard': {
        _bb: #f7f1c7
        _bg: #f9f5d7
        _hl: #f2e5bc
        _bd: #d5c4a1
        _fg: #3c3836
        _cm: #665c54
        _ac: #d65d0e
        _sh: #00000006
    },
    'gruvbox-light-soft': {
        _bb: #f0e1b1
        _bg: #f2e5bc
        _hl: #ebdbb2
        _bd: #d5c4a1
        _fg: #3c3836
        _cm: #665c54
        _ac: #d65d0e
        _sh: #00000008
    },
    'deep-dark': {
        _bb: #0d0d0d
        _bg: #111111
        _hl: #181818
        _bd: #232323
        _fg: #eff0f1
        _cm: #cccccc
        _ac: #00adee
        _sh: #00000040
    },
    'breeze-dark': {
        _bb: #1f2225
        _bg: #232629
        _hl: #2a2e32
        _bd: #383e43
        _fg: #eff0f1
        _cm: #bdc3c7
        _ac: #3daee9
        _sh: #00000021
    },
    'solarized-dark': {
        _bb: #032c37
        _bg: #03303c
        _hl: #073642
        _bd: #094453
        _fg: #93a1a1
        _cm: #839496
        _ac: #268bd2
        _sh: #00000018
    },
    'solarized-light': {
        _bb: #fcf3da
        _bg: #fdf6e3
        _hl: #eee8d5
        _bd: #e2d8b8
        _fg: #073642
        _cm: #586e75
        _ac: #00adee
        _sh: #00000009
    },
    'pitch-black': {
        _bb: #0a0a0a
        _bg: #000000
        _hl: #141414
        _bd: #212121
        _fg: #cccccc
        _cm: #a0a0a0
        _ac: #00adee
        _sh: #ffffff08
    },
    'inspired-dark': {
        _bb: #272a2d
        _bg: #232629
        _hl: #1e2124
        _bd: #414244
        _fg: #eeeeee
        _cm: #cccccc
        _ac: #5e8acc
        _sh: #00000023
    },
    'adapta-nokto': {
        _bb: #202a2f
        _bg: #222d32
        _hl: #263238
        _bd: #324047
        _fg: #d5d5d5
        _cm: #9b9b9b
        _ac: #1abc9c
        _sh: #00000016
    },
    'dracula': {
        _bb: #252732
        _bg: #282a36
        _hl: #34374a
        _bd: #46495d
        _fg: #f8f8f2
        _cm: #c8c8c2
        _ac: #50fa7b
        _sh: #00000023
    },
    'nord-dark': {
        _bb: #2b313c
        _bg: #2e3440
        _hl: #3b4252
        _bd: #434c5e
        _fg: #eceff4
        _cm: #c8ced9
        _ac: #5e81ac
        _sh: #00000021
    },
    'nord-light': {
        _bb: #e7ebf1
        _bg: #eceff4
        _hl: #dfe4ec
        _bd: #c2c9d5
        _fg: #2e3440
        _cm: #535c6e
        _ac: #bf616a
        _sh: #00000009
    },
    'arc-dark': {
        _bb: #2e333d
        _bg: #343944
        _hl: #3c414e
        _bd: #475162
        _fg: #c1c8d1
        _cm: #b3bac5
        _ac: #5294e2
        _sh: #00000032
    },
    'havoc-os': {
        _bb: #0f1112
        _bg: #141618
        _hl: #1c1e20
        _bd: #2a2f33
        _fg: #eeeeee
        _cm: #b9baba
        _ac: #0794d4
        _sh: #00000050
    },
    'nier': {
        _bb: #2d2b25
        _bg: #33302a
        _hl: #48453c
        _bd: #71655b
        _fg: #e3decc
        _cm: #c5c1b0
        _ac: #fe8019
        _sh: #00000035
    },
    'github-dark': {
        _bb: #1c1c1c
        _bg: #181818
        _hl: #222222
        _bd: #404040
        _fg: #e6e6e6
        _cm: #bfbfbf
        _ac: #4f8cc9
        _sh: #00000040
    },
    'moonlight': {
        _bb: #191b28
        _bg: #1e2030
        _hl: #212237
        _bd: #131421
        _fg: #c8d3f5
        _cm: #828bb8
        _ac: #82aaff
        _sh: #00000030
    },
    'monokai': {
        _bb: #242520
        _bg: #272822
        _hl: #2d2e27
        _bd: #49483E
        _fg: #e8e8e3
        _cm: #c5b49a
        _ac: #fd9720
        _sh: #00000035
    },
    'horizon': {
        _bb: #1a1c23
        _bg: #1c1e26
        _hl: #252732
        _bd: #323543
        _fg: #fdf0ed
        _cm: #9fa3a6
        _ac: #f09383
        _sh: #00000035
    },
    'doom-one': {
        _bb: #23272e
        _bg: #21242b
        _hl: #282c34
        _bd: #3c414e
        _fg: #bbc2cf
        _cm: #808890
        _ac: #51afef
        _sh: #00000035
    },
    'brave-dark': {
        _bb: #1d1d1d
        _bg: #222222
        _hl: #282828
        _bd: #393939
        _fg: #ededed
        _cm: #909192
        _ac: #f96234
        _sh: #00000045
    },
    'custom': {
        _bb: bb
        _bg: bg_
        _hl: hl
        _bd: bd
        _fg: fg_
        _cm: cm
        _ac: ac_
        _sh: sh
    },
}

// Color generator.
for name, colors in Primary {
    if (name == primary) {
        /// Generate Stylus-lang variables.
        define(key, val, g) for key, val in colors
    }
}

@-moz-document regexp('(https?|file|(moz|chrome)-extension)://.*') {
    :root {

        /// Secondary colors.
        if ( secondary == 'gruvbox-neutral' ) {
            --red    : #cc241d i
            --orange : #d64d0e i
            --yellow : #d79921 i
            --magenta: #c16286 i
            --violet : #a14286 i
            --green  : #98971a i
            --blue   : #458588 i
            --cyan   : #689d6a i
        } else if ( secondary == 'gruvbox-bright' ) {
            --red    : #fb4934 i
            --orange : #fe8019 i
            --yellow : #fabd2f i
            --magenta: #d3859b i
            --violet : #b3659b i
            --green  : #b8bb26 i
            --blue   : #83a598 i
            --cyan   : #8ec07c i
            --white  : #444444 i
        } else if ( secondary == 'gruvbox-faded' ) {
            --red    : #9d0006 i
            --orange : #af3a03 i
            --yellow : #b57614 i
            --magenta: #8f3f71 i
            --violet : #6f1f71 i
            --green  : #79740e i
            --blue   : #076678 i
            --cyan   : #427b58 i
        } else if ( secondary == 'deep-dark' ) {
            --red    : #da4453 i
            --orange : #f79a63 i
            --yellow : #fdbc4b i
            --magenta: #fe9ead i
            --violet : #60459f i
            --green  : #27ae60 i
            --blue   : #2980b9 i
            --cyan   : #1abc9c i
        } else if ( secondary == 'solarized' ) {
            --red    : #dc322f i
            --orange : #cb4b16 i
            --yellow : #b58900 i
            --magenta: #d33682 i
            --violet : #6c71c4 i
            --green  : #859900 i
            --blue   : #268bd2 i
            --cyan   : #2aa198 i
        } else if ( secondary == 'dracula' ) {
            --red    : #ff5555 i
            --orange : #ffb86c i
            --yellow : #f1fa8c i
            --magenta: #ff79c6 i
            --violet : #bd93f9 i
            --green  : #50fa7b i
            --blue   : #8be9fd i
            --cyan   : #59f7d2 i
            --white  : #444444 i
        } else if ( secondary == 'nord' ) {
            --red    : #bd616a i
            --orange : #d08770 i
            --yellow : #ebcb8b i
            --magenta: #b48ead i
            --violet : #81a1c1 i
            --green  : #a3be8c i
            --blue   : #88c0d0 i
            --cyan   : #8fbcbb i
            --white  : #444444 i
        } else if ( secondary == 'github-dark') {
            --yellow : #ffcc33 i
            --orange : #fe9600 i
            --red    : #ff4444 i
            --magenta: #8368aa i
            --violet : #6e5494 i
            --blue   : #4f8cc9 i
            --cyan   : #4d5eff i
            --green  : #008833 i
        } else if ( secondary == 'moonlight' ) {
            --red    : #ff5370 i
            --orange : #ff995e i
            --yellow : #ffc777 i
            --magenta: #fca7ea i
            --violet : #c597f9 i
            --green  : #c3e88d i
            --blue   : #82aaff i
            --cyan   : #86e1fc i
            --white  : #444444 i
        } else if ( secondary == 'monokai' ) {
            --red    : #e73c50 i
            --orange : #fd9720 i
            --yellow : #e6db74 i
            --magenta: #f92772 i
            --violet : #ae81ff i
            --green  : #a6e22d i
            --blue   : #7aa6da i
            --cyan   : #66d9ef i
            --white  : #333333 i
        } else if ( secondary == 'horizon' ) {
            --red    : #e95678 i
            --orange : #f09383 i
            --yellow : #fab795 i
            --magenta: #db77cc i
            --violet : #b877db i
            --green  : #09f7a0 i
            --blue   : #21bfc2 i
            --cyan   : #59e3e3 i
            --white  : #333333 i
        } else if ( secondary == 'doom-one' ) {
            --red    : #ff6c6b i
            --orange : #da8548 i
            --yellow : #ecbe7b i
            --magenta: #c678dd i
            --violet : #a9a1e1 i
            --green  : #98be65 i
            --blue   : #51afef i
            --cyan   : #46d9ff i
            --white  : #222222 i
        } else {
            --red    : red     i
            --orange : orange  i
            --yellow : yellow  i
            --magenta: magenta i
            --violet : violet  i
            --green  : green   i
            --blue   : blue    i
            --cyan   : cyan    i
        }

        /// Default variables.
        --bb: _bb i
        --bg: _bg i
        --hl: _hl i
        --bd: _bd i
        --fg: _fg i
        --cm: _cm i

        // Explicitly overwrite accent variable.
        if (ow_acvar) {
            --ac: ow_ac i
            _ac = ow_ac
        } else {
            --ac: _ac i
        }

        // Explicitly overwrite bb variable.
        if (ow_bbvar) {
            --bb: ow_bb i
            _bb = ow_bb
        } else {
            --bb: _bb i
        }

        // Explicitly overwrite shadow variable.
        if (ow_shvar) {
            --sh: ow_sh i
            _sh = ow_sh
        } else {
            --sh: _sh i
        }

        // Shim for old variables.
        --dark   : var(--bg) i
        --darken : var(--hl) i
        --darker : var(--bd) i
        --light  : var(--fg) i
        --lighter: var(--cm) i
        --accent : var(--ac) i
        --shadow : var(--sh) i

        /// RGB variables.
        /// Shim for Dark-Instagram.
        --bb-rgb      to_rgb(_bb) i
        --dark-rgb    to_rgb(_bg) i
        --darken-rgb  to_rgb(_hl) i
        --darker-rgb  to_rgb(_bd) i
        --light-rgb   to_rgb(_fg) i
        --lighter-rgb to_rgb(_cm) i
        --accent-rgb  to_rgb(_ac) i
        --shadow-rgb  to_rgb(_sh) i

        // Shim for @RaitaroH's DeepDark variables.
        if (deepdark) {
            --main-color       : var(--ac) i
            --main-background  : var(--bg) i
            --hover-background : var(--bd) i
            --second-background: var(--hl) i
            --main-text        : var(--fg) i
            --dimmer-text      : var(--cm) i
        }

        /// Shim for Dark-WhatsApp's intro image.
        sac = (ow_acvar) ? to_svg(ow_ac) : to_svg(_ac)
        sbg = to_svg(_bg)
        _1  = "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg'  "
        _1 += "height='256' width='256'><g stroke='"
        _2  = "'><path d='M128.4901 30.8659a95.4375 95.4375 0 00-95.4375 95.4375"
        _2 += " 95.4375 95.4375 0 0014.168 50.0332L35.6698 221.276l44.7989-12.49"
        _2 += "8a95.4375 95.4375 0 0048.0214 12.9629 95.4375 95.4375 0 0095.4375"
        _2 += "-95.4375 95.4375 95.4375 0 00-95.4375-95.4375z' fill='"
        _3  = "' fill-rule='evenodd' stroke-width='18' stroke-linecap='square'/>"
        _3 += "<path d='M97.8104 79.8463c-4.9671.0406-13.5028 2.0796-17.7812 14."
        _3 += "8946-6.8318 20.4631 12.5737 43.3028 27.2438 57.4735 14.7975 14.29"
        _3 += "38 43.1559 26.507 58.0098 21.08 20.5566-8.9065 15.2475-22.9479 15"
        _3 += ".2475-22.9479l-22.9727-11.0878s-2.062-1.206-3.4146.5737c-1.0042 1"
        _3 += ".3213-9.4409 11.3755-9.4409 11.3755s-1.449 1.668-3.827.7402c-5.75"
        _3 += "74-2.2462-14.2018-7.4856-18.5314-10.7795-6.8875-5.2399-12.957-13."
        _3 += "0846-16.9473-19.668-1.2556-2.5597.6953-4.709.6953-4.709s6.0303-8."
        _3 += "2629 7.0176-9.5566c1.0068-1.3194.2539-3.3633.2539-3.3633l-10.539-"
        _3 += "23.2285s-2.0334-.8212-5.0138-.7969z' fill='"
        _4  = "' stroke-linejoin='round'/></g></svg>"
        _i  = s('url("%s%s%s%s%s%s%s")', unquote(_1), sac, unquote(_2), sbg,
                                         unquote(_3), sac, unquote(_4))

        // Override WhatsApp selectors.
        &:not(#z), /.dark:not(#z) {
            // Shim for Dark-WhatsApp message bubbles.
            if (whatsapp && wa_msg_c) {
                --msg-in-0:  lighten(_bd, 4%) i
                --msg-in-1:  lighten(_bd, 9%) i
                --msg-out-0: lighten(_hl, 4%) i
                --msg-out-1: lighten(_hl, 9%) i
            } else if (whatsapp) {
                --msg-in-0:  _bd i
                --msg-in-1:  lighten(_bd, 4%) i
                --msg-out-0: _hl i
                --msg-out-1: lighten(_hl, 4%) i
            }

            // Shim for Dark-WhatsApp intro image.
            if (wa_intro) {
                &:not(#z) { --intro-image: _i i }
            }
        }
    }
}
